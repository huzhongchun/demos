$(function(){var a=Jumei.addModule("pay",{init:function(){this.initEvent(),this.pay()},initEvent:function(){var a=function(a){1===a?$(".sub").addClass("sub-gray"):$(".sub").removeClass("sub-gray"),20===a?$(".add").addClass("add-gray"):$(".add").removeClass("add-gray")};$(".sub").tap(function(){var e=$(".input-type"),t=e.val();if(t=parseInt(t),t>1){t-=1,a(t),e.val(t);var i=parseFloat($(".price span").html())*parseFloat(t)+parseFloat($(".yunfei span").html());$(".total-num").html(i.toFixed(2))}}),$(".add").tap(function(){var e=$(".input-type"),t=e.val();if(t=parseInt(t),t+=1,20>=t){a(t),e.val(t);var i=parseFloat($(".price span").html())*parseFloat(t)+parseFloat($(".yunfei span").html());$(".total-num").html(i.toFixed(2))}});var e=!0;$(".weixin-pay").click(function(){if(Jumei.ja("weidian","weixin","querendingdan"),e===!0){var a=$("#shop-id").val(),t=$("#item-id").val(),i=$("#item-type").val(),d=$("#sku").val(),s=$("#delivery-fee").val(),n="";if(!($(".address").length>0))return alert("亲，请您添加地址！"),!1;n=$(".address").attr("address-id"),$("body").loadding(),$.ajax({type:"POST",url:"/microshop/pay/ajax_index",dataType:"json",data:{shop_id:a,item_id:t,item_type:i,address:n,sku:d,delivery_fee:s,num:$(".input-type").val()},success:function(d){var s="shop_id="+a+"&item_id="+t+"&item_type="+i;1==d.state?WeixinJSBridge.invoke("getBrandWCPayRequest",JSON.parse(d.wx.data),function(a){e=!0,$("body").loadding("close"),s+="&order="+d.order+"&dateTime="+d.dateTime,"get_brand_wcpay_request:ok"==a.err_msg?window.location.href="/microshop/pay/success?state=ok&"+s:"get_brand_wcpay_request:cancel"==a.err_msg||(window.location.href="/microshop/pay/success?state=fail&"+s)}):(alert("支付失败"),$("body").loadding("close"))},error:function(){$("body").loadding("close"),e=!0}})}})}});a.init()});