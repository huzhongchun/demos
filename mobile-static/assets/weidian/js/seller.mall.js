$(function(){var a=Jumei.addModule("weidian",{init:function(){$(".goods-row-two-des").subStr(40),$(".imglazy").imglazyload({classSelector:".imglazy"});for(var a=$(".module-boxs"),t=0;t<a.length;t++)$(a[t]).find(".goods-row-two-area").children().length<22&&$(a[t]).find(".get-more").hide();this.initEventListener(),this.getNeedModule()},getNeedModule:function(){var a=this,t=Jumei.getModule("ui.toast");a.toastObj=new t({animateTime:.5,animateCurves:"ease",stopTime:.8})},initEventListener:function(){var a=this;a.n=1;var t=($(".add-recommend"),!0);$(".goods-row-two-items").click(function(){Jumei.ja("weidianAPP","click","dianjishangpinxiangqing")}),$(window).on("click",".add-recommend",function(o){o.preventDefault();var e=this,i=$(e).attr("data-added"),n=$(e).html(),s=$(this).attr("data-hashid");t&&"添加推荐"==n&&(t=!1,"no"==i&&$.ajax({url:"/microshop/manage/ajaxAddRecommendation",type:"POST",data:{item_id:s},success:function(o){"ok"==o.toLowerCase()?($(e).attr("data-added","yes"),$(e).html("取消推荐"),a.toastObj.show("添加成功，返回我的微店查看"),a.toastObj.animateEndCallback=function(){t=!0}):"limited"==o.toLowerCase()?(a.toastObj.show("别贪心，只能推荐6个商品哟！"),a.toastObj.animateEndCallback=function(){t=!0}):(a.toastObj.show("添加商品失败"),a.toastObj.animateEndCallback=function(){t=!0})},error:function(){alert("网络错误！")}})),t&&"取消推荐"==n&&$.ajax({url:"/microshop/manage/ajaxCancelRecommendation",type:"POST",data:{item_id:s},success:function(o){"ok"==o?($(e).attr("data-added","no"),$(e).html("添加推荐"),a.toastObj.show("商品已从我的推荐中移除"),a.toastObj.animateEndCallback=function(){t=!0}):(a.toastObj.show("移除商品失败"),a.toastObj.animateEndCallback=function(){t=!0})},error:function(){alert("网络错误！")}})}),$(".get-more").click(function(){var t=this;a.shopName=$(".name-text").html(),a.category=$(this).attr("data-type");var o=$(this).parent().children()[1];$.ajax({url:"/microshop/manage/ajaxGetPageByCategory?category="+a.category+"&page="+ ++a.n,type:"GET",dataType:"json",success:function(a){if(a.length<22&&$(t).hide(),0==a.length)return alert("没有更多数据了！"),!1;for(var e=0;e<a.length;e++){var i="",n=a[e];i='<a class="goods-row-two-items fl" href="/microshop/buy/detail?shop_id=1___item_id='+n.jumei_item_id+"___item_type="+n.jumei_item_type+'___can_buy=false"><div class="goods-row-two-pic"><img class="imglazy" src="'+n.original_image+'"><div class="goods-row-two-commission-icon">佣金￥'+n.commission+'</div></div><div class="goods-row-two-des">'+n.medium_name+'</div><div class="goods-row-two-price clearfloat"><div class="goods-row-two-price-boxs fl"><span class="goods-row-two-price-now">￥'+n.discounted_price+'</span><span class="goods-row-two-price-old">￥'+n.original_price+'</span></div><div class="goods-row-two-add-btn add-recommend fr" data-added="no" data-hashid="'+n.id+'">添加推荐</div></div></a>',$(o).append(i)}},error:function(){alert("网络错误！")}})})}});a.init()});