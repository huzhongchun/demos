!function(){window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)}}();var e=function(e){this.staticBase=e.staticBase,this.wrapper=e.wrapper,this.heightAdd=e.heightAdd||10,this.declineRate=e.declineRate||10,this.success=e.success||function(){}};e.prototype={_height:0,_timer:null,_create:function(){this._tpl='<div id="flash-lightning-container"><div id="flash-lightning"><img class="flash-lightning-img" src="'+this.staticBase+'image/widget/energy/energy_flash.png"/><div class="flash-lamp"></div><div class="energy-bg"></div><div class="energy-name"></div></div></div><div class="energy-bottom"><img src="'+this.staticBase+'image/widget/energy/girl.png" class="energy-bottom-girl"/><div class="energy-btn-container"><div class="energy-btn-start"><div class="btn-battery"><div class="battery-image"></div><div class="battery-image"></div><div class="battery-image"></div><div class="battery-image"></div><div class="battery-image"></div></div></div></div><span class="energy-txt">狂点按钮充能量</span></div>',$(this.wrapper).html(this._tpl),this._decline(),this._initEvent(),this._showBar(),this._initAnimateBtn()},_decline:function(){var e=this;e._timer=setInterval(function(){e._height>=1&&e._height<116?e._height=e._height-4:e._height>=116&&(clearInterval(e._timer),e.success())},1e3/e.declineRate)},_showBar:function(){function e(){for(var e=Math.floor(i._height/r),t="",n=0;e>n;n++)t+='<div class="battery-image"></div>';s.html(t)}function t(){a.height(i._height),n(t),e()}var i=this,n=window.requestAnimFrame,a=$(".energy-name"),s=$(".btn-battery"),r=23.2;t()},_initAnimateBtn:function(){var e=$(".energy-btn-start");this._btnTimer=setInterval(function(){e.toggleClass("energy-btn-press")},100)},_initEvent:function(){var e=this,t=$(".energy-btn-start"),i=$(".flash-lamp");t.on("tap",function(n){t.addClass("energy-btn-press"),i.toggleClass("flash-lamp-on"),setTimeout(function(){t.removeClass("energy-btn-press")},50),clearInterval(e._btnTimer),n.preventDefault(),e._height<116&&(e._height=e._height+e.heightAdd)})}};var t=$.fn.energyBar;$.fn.energyBar=function(t){return this.each(function(){var i=$(this),n=i.data("energyBar");n||i.data("energyBar",n=new e(t)),n._create(),"string"==typeof t&&n[t].call(i)})},$.fn.energyBar.Constructor=e,$.fn.energyBar.noConflict=function(){return $.fn.energyBar=t,this}}(Zepto);