Jumei.widget("ui.carousel3D",{init:function(t){this.options={id:"carousel3D-boxs",index:0,perspective:600,rotateY:75,transitionTime:.8,isShowDots:!0,isPlayAuto:!1,autoPlayDirection:"right",autoPlayChangeTime:3e3,animateEndCallBack:null,prev:"",next:""},this._super.call(this,t)},_create:function(){var t=this,e=this.options;if(t.flag=!1,!e.id||!document.getElementById(e.id.replace(/^#/,"")))return console.log("id或dom为null!"),!1;e.dom=document.getElementById(e.id.replace(/^#/,"")),e.width=e.dom.clientWidth,e.height=e.dom.clientHeight,e.translateX=parseInt(e.dom.clientWidth*(Math.cos(e.rotateY*Math.PI/180)+.5)),e.translateZ=parseInt(e.dom.clientWidth*Math.sin(e.rotateY*Math.PI/180)),e.Str_change_left_l="-webkit-transform: translateX(-"+(e.translateX+50)+"px) translateZ(-"+(e.translateZ+50)+"px) rotateY("+e.rotateY+"deg);opacity:0;",e.Str_change_left="-webkit-transform: translateX(-"+e.translateX+"px) translateZ(-"+e.translateZ+"px) rotateY("+e.rotateY+"deg);opacity:0.5;",e.Str_change_center="-webkit-transform: translateX(0px) translateZ(0px) rotateY(0deg);opacity:1;",e.Str_change_right="-webkit-transform: translateX("+e.translateX+"px) translateZ(-"+e.translateZ+"px) rotateY(-"+e.rotateY+"deg);opacity:0.5;",e.Str_change_right_r="-webkit-transform: translateX("+(e.translateX+50)+"px) translateZ(-"+(e.translateZ+50)+"px) rotateY(-"+e.rotateY+"deg);opacity:0;",e.dom.style.cssText+="-webkit-transform-style: preserve-3d;-webkit-perspective: "+e.perspective+"px;position:relative";var a=e.dom,n=a.children;if(e.dots_len=n.length,e.dots_len<=1)return!1;if(e.dots_len<5){for(var s=0;s<e.dots_len;s++){var i=n[s].cloneNode(!0);a.appendChild(i)}e.isCloneNode=!0}if(e.isShowDots){var r=document.createElement("div");r.className="carousel-dots-area",a.parentNode.appendChild(r);for(var s=0;s<e.dots_len;s++){var l=document.createElement("b");r.appendChild(l)}e.dots=document.querySelector(".carousel-dots-area").children,t.dotsChange(e.index)}e.childs=a.children;for(var s=0;s<e.childs.length;s++)e.childs[s].style.cssText+="width:"+e.width+"px ;height: "+e.height+"px ;position: absolute;opacity:0;-webkit-transition: -webkit-transform "+e.transitionTime+"s ease 0s,opacity "+e.transitionTime+"s ease 0s;";e.maxNum=e.childs.length-1,setTimeout(function(){var t=e.index-1;t=0>t?e.maxNum:t,e.childs[t].style.cssText+=e.Str_change_left;var a=t-1;a=0>a?e.maxNum:a,e.childs[a].style.cssText+=e.Str_change_left_l,e.childs[e.index].style.cssText+=e.Str_change_center;var n=e.index+1;n=n>e.maxNum?0:n,e.childs[n].style.cssText+=e.Str_change_right;var s=n+1;s=s>e.maxNum?0:s,e.childs[s].style.cssText+=e.Str_change_right_r},200),t.initEventListener(),e.isPlayAuto&&setInterval(function(){"left"==e.autoPlayDirection?t.moveLeft(e.index):t.moveRight(e.index)},e.autoPlayChangeTime)},moveRight:function(t){var e=this,a=this.options,n=t,s=n-1;s=0>s?a.maxNum:s;var i=n+1;i=i>a.maxNum?0:i;var r=i+1;r=r>a.maxNum?0:r;var l=r+1;l=l>a.maxNum?0:l;var o=a.childs[n],c=a.childs[s],d=a.childs[i],h=a.childs[r],m=a.childs[l];c.style.cssText+=a.Str_change_left_l,o.style.cssText+=a.Str_change_left,d.style.cssText+=a.Str_change_center,h.style.cssText+=a.Str_change_right,m.style.cssText+=a.Str_change_right_r,a.index=i;var u=e.getNaturalIndex(a.index);a.isShowDots&&e.dotsChange(u),e.moveCalllBack.call(e,u)},moveLeft:function(t){var e=this,a=this.options,n=t,s=n+1;s=s>a.maxNum?0:s;var i=n-1;i=0>i?a.maxNum:i;var r=i-1;r=0>r?a.maxNum:r;var l=r-1;l=0>l?a.maxNum:l;var o=a.childs[n],c=a.childs[s],d=a.childs[i],h=a.childs[r],m=a.childs[l];c.style.cssText+=a.Str_change_right_r,o.style.cssText+=a.Str_change_right,d.style.cssText+=a.Str_change_center,h.style.cssText+=a.Str_change_left,m.style.cssText+=a.Str_change_left_l,a.index=i;var u=e.getNaturalIndex(a.index);a.isShowDots&&e.dotsChange(u),e.moveCalllBack.call(e,u)},initEventListener:function(){var t=this,e=this.options;e.next&&document.getElementById(e.next).addEventListener("click",function(){t.moveRight(e.index)}),e.prev&&document.getElementById(e.prev).addEventListener("click",function(){t.moveLeft(e.index)});var a=function(){e.X<-5&&t.moveRight(e.index),e.X>5&&t.moveLeft(e.index)};e.dom.addEventListener("touchstart",function(t){e.pageX=t.touches[0].pageX,e.pageY=t.touches[0].pageY,e.X=0}),e.dom.addEventListener("touchmove",function(t){e.X=t.touches[0].pageX-e.pageX}),e.dom.addEventListener("touchend",a),e.dom.addEventListener("touchcancel",a);for(var n=e.dom.children,s=0;s<n.length;s++)n[s].addEventListener("webkitTransitionEnd",function(){t.webkitTransitionEndCallBack.call(t)},!1)},dotsChange:function(t){var e=this.options;document.querySelector(".carousel-dot-selected")&&document.querySelector(".carousel-dot-selected").setAttribute("class",""),e.dots[t].className="carousel-dot-selected"},getNaturalIndex:function(t){var e=this.options;return e.isCloneNode?t%e.dots_len:t},moveCalllBack:function(){this.flag=!0},webkitTransitionEndCallBack:function(){var t=this,e=this.options;if(1==t.flag&&e.animateEndCallBack){t.flag=!1;var a=t.getNaturalIndex(e.index);e.animateEndCallBack.call(t,a)}}});