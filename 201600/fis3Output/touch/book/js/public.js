define(function(e){function t(t){var a=e("widget/wxShare"),s=$.extend({title:"新世相图书馆",desc:"3000人和我一起找到的办法 ，怎么能保证治好你不读书的绝症？",image:"http://resource.bj.taooo.cc/thefair/library/images/share_icon_2.png",link:location.origin+"/book/home/index"},t),i=new a({shareAppMessageTitle:s.title,shareAppMessageDesc:s.desc,shareAppMessageLink:s.link,shareAppMessageImgUrl:s.image,shareAppMessageSuccessCallback:function(){},shareAppMessageCancelCallback:function(){},shareTimelineTitle:s.desc,shareTimelineLink:s.link,shareTimelineImgUrl:s.image,shareTimelineSuccessCallback:function(){},shareTimelineCancelCallback:function(){}});return i}function a(){$(".star-list").each(function(){var e=$(this).data().stars,t=$(this).find(".star-icon"),a=!1,s=Math.round(e);s>e?dHalf=!1:e>s?(s++,a=!0):s==e&&(dHalf=!1),10*e%10==5&&(a=!0);for(var i=0;s>i;i++)$(t[i]).addClass(a&&i==s-1?"half":"active")})}var s={init:function(){var e=$(".public-loading-bg");e&&0==e.length&&$("body").append('<div class="public-loading-bg"></div>');var t=$(".public-loading-box");return t&&0==t.length&&$("#scale-wrapper").append('<div class="public-loading-box"></div>'),this},show:function(){$(".public-loading-bg").show(),$(".public-loading-box").show()},hide:function(){$(".public-loading-bg").hide(),$(".public-loading-box").hide()}},i={init:function(e){var t=this;this.settings=$.extend({autoShow:!1,content:"",height:""},e);var a=this.settings;a.autoShow?$(".set-dialog-bg").addClass("auto-show"):"",$(".set-dialog-bg").on("touchmove",function(e){e.preventDefault()});var s=$(".set-dialog-container").height(),i=$(window).height();s>i&&(s=i),$(".set-dialog-container").css({height:a.height?a.height+"px":s+"px",overflow:s>=i?"scroll":"hidden"}),a.autoShow?t._setDialogContainerTransform(0,0,0):t._setDialogContainerTransform(0,s+20+"px",0),t.initEvent()},initEvent:function(){$(".set-dialog-container").on("click",".radio-label",function(){var e=$(this).parent(".radio-select-box");if(e.find(".selected").removeClass("selected"),$(this).addClass("selected"),"wechat"==$(this).find("input").attr("name")){var t=$('input[name="wechat"]:checked').val();"yes"==t?($(".sms-setting").hide(),$(".wechat-input-setting").show()):($(".sms-setting").show(),$(".wechat-input-setting").hide())}}),$(".set-dialog-container .submit-btn").on("click",function(){var e=$('input[name="wechat"]:checked').val(),t=$('input[name="sms"]:checked').val();if("yes"==e){var a=$(".wechat-input").val().trim();if(!a)return alert("请填写微信号"),!1;t=""}$.ajax({url:"/book/user/set_user_setting",type:"post",data:{status:e,wechat:a,sms_status:t},dataType:"json",success:function(e){0==e.code?(alert("设置成功!"),location.reload()):alert(e.message.text)},error:function(e){var t=JSON.parse(e.responseText);alert(t.message.text)}})})},show:function(e){var t=this;if($(".set-dialog-bg").show(),t._setDialogContainerTransform(0,0,0),e&&e.wechat&&e.wechat.status){var a="yes"==e.wechat.status?"yes":"no";$('input[name="sms"]').removeAttr("checked"),$(".wechat-setting .selected").removeClass("selected"),$('.wechat-setting input[value="'+a+'"]').attr("checked","checked").parents(".radio-label").addClass("selected"),"no"==e.wechat.status?($(".sms-setting").show(),$(".wechat-input-setting").hide()):($(".sms-setting").hide(),$(".wechat-input-setting").show())}if(e&&e.sms&&e.sms.status){var a="yes"==e.sms.status?"yes":"no";$('input[name="sms"]').removeAttr("checked"),$(".sms-setting .selected").removeClass("selected"),$('.sms-setting input[value="'+a+'"]').attr("checked","checked").parents(".radio-label").addClass("selected")}e&&e.wechat&&e.wechat.id&&$(".set-dialog-container .wechat-input").val(e.wechat.id)},hide:function(){var e=this,t=$(".set-dialog-container").height();$(".set-dialog-bg").hide(),e._setDialogContainerTransform(0,t+20,0)},_setDialogContainerTransform:function(e,t,a){var s=e?e:0,i=t?t:0,n=a?a:0;$(".set-dialog-container").css({transform:"translate3d("+s+"px,"+i+"px,"+n+"px)","-moz-transform":"translate3d("+s+"px,"+i+"px,"+n+"px)","-webkit-transform":"translate3d("+s+"px,"+i+"px,"+n+"px)"})}};return{setWxShareContent:t,loading:s,initCommentStars:a,settingDialog:i}});