$(function(){window.Jumei.changeScheme(".url-scheme");var i=Jumei.addModule("weidian",{init:function(){this.initEvent(),this.initScroll(),this.initCut(),this.initImage(),this.initPage()},initImage:function(){$(".lazy-image").imglazyload()},initEvent:function(){$(".share").click(function(i){i.preventDefault(),$("#shouchang").show()}),$("#shouchang").click(function(){$("#shouchang").hide()})},initScroll:function(){var i=null,s=1;$(document).on("touchstart",function(){i=$(window).scrollTop()}),$(window).scroll(function(){var e=$(window).scrollTop();e>i?1==s&&setTimeout(function(){$("#bottom-nav").addClass("fixedhide"),s=0},100):0===s&&setTimeout(function(){$("#bottom-nav").removeClass("fixedhide"),s=1},100)})},initCut:function(){$(".goods-des .des").subStr(90),$(".goods-row-two-des .des").subStr(45),$(".nav-item").on("click",function(){$(".nav-item").each(function(){$(this).removeClass("active")}),$(this).addClass("active");var i=107*$(this).index();$(".selected-arrow").css({"-webkit-transform":"translate3d("+i+"px,0,0)"})})},initPage:function(){var i='<% for(var i in data){ if(data.hasOwnProperty(i)){ var vo = data[i]; %><a href="/microshop/buy/detail?shop_id=<%=vo.shopId%>&item_id=<%=vo.jumei_item_id%>&item_type=<%=vo.jumei_item_type%>" class="goods-row-two-items fl"><div class="goods-row-two-pic"><img class="lazy-image" src="<%=vo.original_image%>"></div><div class="goods-row-two-des"><%if (vo.medium_name !=""){ %><span class="des"><%=vo.medium_name%></span><% }else { %><span class="des"><%=vo.short_name%></span><% } %></div><div class="goods-row-two-price clearfloat"><div class="goods-row-two-price-boxs fl"><% if(vo.discounted_price != ""){ %><span class="price-now">￥<%=vo.discounted_price%></span><span class="price-old">￥<%=vo.original_price%></span><% } %></div><% if (vo.discount != 10){ %><div class="goods-row-two-add-btn fr"><span><%=vo.discount%>折</span></div><% } %></div></a><% } } %>',s='<% for(var i in data){ if(data.hasOwnProperty(i)){ var vo = data[i]; %><a href="/microshop/buy/detail?shop_id=<%=vo.shopId%>&item_id=<%=vo.jumei_item_id%>&item_type=<%=vo.jumei_item_type%>"><div class="selected-recomend-goods-items"><div class="goods-pic"><% if(vo.image.length >0){ %><img class="lazy-image" src="{=vo.image[0]=}"><% }else{ %><% if(vo.dx_image){ %><img class="lazy-image" src="<%=vo.dx_image%>"><% }else{ %><img class="lazy-image" src="<%=vo.original_image%>"><% } %><% } %></div><div class="goods-des"><% if(vo.description != ""){ %><span class="des"><%=vo.description%></span><% }else if(vo.medium_name != ""){ %><span class="des"><%=vo.medium_name%></span><% }else{ %><span class="des"><%=vo.short_name%></span><% } %></div><div class="goods-price clearfloat"><div class="price-area fl"><span class="price-now">￥<%=vo.discounted_price%></span><span class="price-old">￥<%=vo.original_price%></span></div><% if(vo.discount != 10){ %><div class="start-buy"><%=vo.discount%>折</div><% } %></div></div></a><% } } %>';$(".more-page").on("click",function(){var e=$(this).parent(),a=this,o=parseInt(e.attr("page")),t=!0;t&&(t=!1,o+=1,$.ajax({type:"get",url:"/microshop/buy/ajaxGetPageByCategory",dataType:"json",data:{shop_id:e.attr("shop_id"),page:o,category:e.attr("id")},success:function(n){if(e.attr("page",o),t=!0,0===n.length)return alert("对不起，没有更多的商品了~!"),$(a).hide(),!1;if(n.length>0){for(var d in n)n.hasOwnProperty(d)&&(n[d].shopId=e.attr("shop_id"));var r={};if(r.data=n,"本季热卖"==e.attr("id")){var c=Jumei.parseTpl(s,r);e.find(".selected-recomend-goods-area").append(c)}else{var c=Jumei.parseTpl(i,r);e.find(".goods-row-two-area").append(c)}$(".goods-des .des").subStr(90),$(".goods-row-two-des .des").subStr(45),n.length<22&&$(a).hide()}else $(a).hide()},error:function(){t=!0}}))})}});i.init()});