$(function(){var r='<% for(var i in areas){ if(areas.hasOwnProperty(i)){ var  item = areas[i];%><option value="<%=item.code%>"><%=item.name%></option><% } } %>',i='<option value="">选择省</option>',a='<option value="">选择市</option>',e='<option value="">选择区</option>',t=Jumei.getModule("ui.dialog"),o=new t({element:"body",width:260,height:200,content:'<div id="dialog-container"></div>',title:"提示",type:"default",btn:1,ok:"确定",cancel:"取消",init:function(){},okCallback:null,cancelCallback:function(){}}),n=Jumei.addModule("addaddress",{init:function(){this.initAddress()},initAddress:function(){this.initProvince(),this.initEvent()},initProvince:function(){$("#wrapper").loadding("close"),$.ajax({type:"post",url:"/microshop/order/get_child_area_list?parent_area_code=0",dataType:"json",success:function(a){if(1!==a.status||!a.areas){var e=$("#dialog-container");return $("#wrapper").loadding("close"),e.html("网络不给力，过会儿试试～"),o.show(),!1}var t=Jumei.parseTpl(r,a);$(".province").html(i+t)},error:function(){var r=$("#dialog-container");return $("#wrapper").loadding("close"),r.html("网络不给力，过会儿试试～"),o.show(),!1}})},initEvent:function(){$(".province").change(function(){var i=$(this).val();$.ajax({type:"post",url:"/microshop/order/get_child_area_list?parent_area_code="+i,dataType:"json",success:function(i){if(1!==i.status||!i.areas){var e=$("#dialog-container");return $("#wrapper").loadding("close"),e.html("网络不给力，过会儿试试～"),o.show(),!1}var t=Jumei.parseTpl(r,i);$(".city").html(a+t)},error:function(){var r=$("#dialog-container");return $("#wrapper").loadding("close"),r.html("网络不给力，过会儿试试～"),o.show(),!1}})}),$(".city").change(function(){$("#wrapper").loadding();var i=$(this).val();$.ajax({type:"post",url:"/microshop/order/get_child_area_list?parent_area_code="+i,dataType:"json",success:function(i){if($("#wrapper").loadding("close"),1!==i.status||!i.areas){var a=$("#dialog-container");return $("#wrapper").loadding("close"),a.html("网络不给力，过会儿试试～"),o.show(),!1}var t=Jumei.parseTpl(r,i);$(".area").html(e+t)},error:function(){var r=$("#dialog-container");return $("#wrapper").loadding("close"),r.html("网络不给力，过会儿试试～"),o.show(),!1}})}),$(".confirm-submit").on("click",function(){var r=$("#dialog-container"),i=$("#username").val();if($.isString(i)&&""===$.trim(i))return r.html("~亲，收货人姓名不能为空！"),o.show(),!1;var a=$("#tell").val();if($.isString(a)&&""===$.trim(a))return r.html("~亲，手机号不能为空！"),o.show(),!1;if(!/^\d{11}$/g.test(a))return r.html("~亲，手机号格式不正确！"),o.show(),!1;var e=$("#province").val();if($.isString(e)&&""===$.trim(e))return r.html("~亲，请选择省份！"),o.show(),!1;var t=$("#city").val();if($.isString(t)&&""===$.trim(t))return r.html("~亲，请选择市！"),o.show(),!1;var n=$("#area").val();if($.isString(n)&&""===$.trim(n))return r.html("~亲，请选择区！"),o.show(),!1;var s=$("#address-detail").val();return $.isString(s)&&""===$.trim(s)?(r.html("~亲，请填写详细地址！"),o.show(),!1):($("#wrapper").loadding(),void $.ajax({type:"post",url:"/microshop/order/address_add",dataType:"json",data:{address:s,receiver_name:i,hp:a,idNum:"",structured_code:n},success:function(i){$("#wrapper").loadding("close");try{if(1!==i.state)return $("#wrapper").loadding("close"),r.html(i.msg),o.show(),!1;if(i.info.address_id>0){var a=$("#query_string").val();a=a+"&select_id="+i.info.address_id,location.href=a}else alert(i.info.message)}catch(e){}},error:function(){return $("#wrapper").loadding("close"),r.html("网络不给力，过会儿试试～"),o.show(),!1}}))})}});n.init()});