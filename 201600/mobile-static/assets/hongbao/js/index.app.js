$(function(){window.loginCallback=function(){location.reload()};var a=function(){var a=$("#carouse-text"),o=0,n=0;$("#carouse-text span").each(function(){n+=this.clientWidth}),a.width(n+10);var i=n-280,t=function(){o-=1,a.css("left",o),Math.abs(o)==i&&(o=0)};setInterval(function(){t()},100)},o={init:function(a){var o=this;switch(a){case"login":o.loginDialog();break;case"share":o.shareDialog();break;case"getbag":o.getbagDialog()}},loginDialog:function(){var a='<div class="common-dialog"><div class="common-title-bg"></div><div class="common-close"></div><div class="common-title">请登录后查看我的红包</div><div class="common-content clear"><div id="none-account">没有聚美账号</div><div id="now-login">现在登录</div></div></div>';$("body").dialog({width:260,height:200,content:a,title:"",type:0,init:function(){$(".common-close").off("tap"),$(".common-close").on("tap",function(){$("#container-dialog").remove()}),$("#none-account").off("tap"),$("#none-account").on("tap",function(){_gaq.push(["_trackEvent","11hongbaoapp","login"]),location.href="jumeimall://page/register?callback=window.loginCallback()"}),$("#now-login").off("tap"),$("#now-login").on("tap",function(){_gaq.push(["_trackEvent","11hongbaoapp","login"]),location.href="jumeimall://page/login?callback=window.loginCallback()"}),$(".common-close").hide()}})},shareDialog:function(){var a='<div class="common-dialog"><div class="common-title-bg"></div><div class="common-close"></div><div class="common-title">分享到微信和小伙伴一起抢红包</div><div class="common-content clearfloat"><div class="share-content clearfloat"><div id="share-friend"><div id="share-friend-icon"></div><div>分享给朋友</div></div><div id="share-pengyouquan"><div id="share-pengyouquan-icon"></div><div>分享到朋友圈</div></div></div></div></div>';$("body").dialog({width:260,height:200,content:a,title:"",type:0,init:function(){$(".common-close").off("tap"),$(".common-close").on("tap",function(){$("#container-dialog").remove()}),n.shareFunc()}})},getbagDialog:function(a){var n='<div class="common-dialog"><div class="common-title-bg"></div><div class="common-close"></div><div class="common-title">'+a+'元红包已充入您的聚美帐号</div><div class="common-content clear"><div class="getbag-share">分享再抢100元红包</div><div class="getbag-tip">微信红包金额随机<br/>微信好友和自己都能抢</div></div></div>';$("body").dialog({width:260,height:200,content:n,title:"",type:0,init:function(){$(".common-close").off("tap"),$(".common-close").on("tap",function(){$("#container-dialog").remove()}),$(".getbag-share").off("tap"),$(".getbag-share").on("tap",function(){$("#container-dialog").remove(),o.init("share")})}})},tipDialog:function(a){var n='<div class="common-dialog"><div class="common-title-bg"></div><div class="common-close"></div><div class="common-content clear"><div class="common-tip" style="padding-bottom: 10px;font-size:13px;">'+a+"</div></div></div>";$("body").dialog({width:260,height:200,content:n,title:"",type:0,init:function(){$(".common-close").off("tap"),$(".common-close").on("tap",function(){$("#container-dialog").remove()}),$(".getbag-share").off("tap"),$(".getbag-share").on("tap",function(){$("#container-dialog").remove(),o.init("share")})}})}},n={shareFunc:function(){var a=["别帮聚美省钱！在聚美买真品防伪商品赚了大红包，快抢","看你深夜为朕点赞，赐聚美真品防伪红包20枚，快抢>","聚美买带防伪码商品送红包！姐抢了十个，快来瓜分…","干爹送我个大红包，我用验钞机验过了，快来抢>>>","聚美双11囤货必备，无满减限制大红包50个，快抢","买过很多带防伪码的商品，只有聚美的送红包，快来抢","深夜点赞，人情肉偿，送你个聚美11.11大红包，快抢"],o=Math.floor(Math.random()*a.length),i={title:"聚美真品防伪派福利送11.11红包",content:a[o],img:"http://images.jumei.com/mobile/act/activities/2014_11/11zhuhuichang/share_hongbao.jpg",url:""};$("#share-friend-icon").off("tap"),$("#share-friend-icon").on("tap",function(){try{Jumei.ja("hongbaoapp11","pengyou")}catch(a){}n.getShareLink(function(a){i.url="http://f.m.jumei.com/envelope/openbag?package="+a,location.href="jumeimall://action/share/weixin?link="+i.url+"&img="+i.img+"&title="+i.title+"&des="+i.content})}),$("#share-pengyouquan").off("tap"),$("#share-pengyouquan").on("tap",function(){try{Jumei.ja("hongbaoapp11","pengyouquan")}catch(a){}n.getShareLink(function(a){i.url="http://f.m.jumei.com/envelope/openbag?package="+a,location.href="jumeimall://action/share/weixin/pengyouquan?link="+i.url+"&img="+i.img+"&title="+i.content+"&des="+i.content})})},getShareLink:function(a){var o=this;$.ajax({type:"post",url:"/envelope/generate",dataType:"json",success:function(n){n.package?a.call(o,n.package):alert("网络不给力，过会儿试试～")},error:function(){$("#wrapper").loadding("close"),alert("网络不给力，过会儿试试～")}})}};animate={init:function(a){var o=$(".animate-num");o.css({top:50,opacity:1}),o.html("+"+a),o.animate({top:"10px",opacity:0},2e3,"ease-out")}};var i=Jumei.create({init:function(){try{JMWebView.toolbar.status="hidden"}catch(o){}var n=$("#none-bag-num"),i=n.find("span").html();n.html('<span style="height: 24px;display: inline-block;line-height: 32px;">'+i+"</span>"),n.parent().find(".fs13").html("幸运值"),$(".total-redbag span").html("拼人品领红包"),$("#product-code .li-title").subStr(46),this.isLogin(),a()},isLogin:function(){var a=$("#islogin").val();""==$.trim(a)?o.init("login"):this.initEvent()},bindLookRedBag:function(){$(".look-redbag").off("tap"),$(".look-redbag").on("tap",function(){try{Jumei.ja("hongbaoapp11","chakanhongbao")}catch(a){}location.href="1"==$("#isactive").val()?"/hongbao/merge":"jumeimall://page/red-envelope"})},initEvent:function(){var a=this;a.bindLookRedBag(),$(".merge-redbag").on("tap",function(){try{Jumei.ja("hongbaoapp11","hebinghongbao")}catch(a){}"1"==$("#isactive").val()?location.href="/hongbao/merge":o.tipDialog("多个红包可以合并，请用电脑登录聚美官网，在我的聚美/红包中合并")}),$(".start-buy-btn").on("tap",function(){try{Jumei.ja("hongbaoapp11","lijigoumai")}catch(a){}location.href="jumeimall://page/homepage"}),$("#continue-buy").on("tap",function(){try{Jumei.ja("hongbaoapp11","jixugoumai")}catch(a){}location.href="jumeimall://page/homepage"}),$("#share-weixin").on("tap",function(){try{Jumei.ja("hongbaoapp11","fenxiang")}catch(a){}o.init("share")}),$(".fangwei-rule,.rule-redbag").on("tap",function(){try{Jumei.ja("hongbaoapp11","fangweima")}catch(a){}location.href="http://s.m.jumei.com/pages/1168?app#rule"}),$(".code-redbag").on("tap",function(){try{Jumei.ja("hongbaoapp11","fangweima")}catch(a){}location.href="http://s.m.jumei.com/pages/1168?app"}),$("#more-btn").on("tap",function(){$(this).hide(),$("#product-code ul").height("auto")}),$(".red-bag").on("tap",function(){var a=$(window).scrollTop();$(window).scrollTo(a+100)}),$(".get-bag").on("tap",function(){var n=this;try{Jumei.ja("hongbaoapp11","lingqu")}catch(i){}if($(n).hasClass("can-get-bag")){var t=$(this).attr("orderid");$("#wrapper").loadding(),$.ajax({type:"post",url:"/envelope/getAuthRedEnvelope",dataType:"json",data:{order_id:t},success:function(i){if("0"==i.status){$(n).removeClass("can-get-bag");var t=$("#none-bag-num span"),e=t.html();t.html(parseInt(e)-1);var c=$("#has-bag-num span"),l=c.html();if(c.html((parseFloat(l)+parseFloat(i.data.amount)).toFixed(1)),$(n).html("已领取"),o.getbagDialog(i.data.amount),$(".look-redbag").length<=0){var r='<div class="look-redbag"><a>查看</a></div>';$(".right-num").attr("style",""),$(".right-num").parent().append(r),a.bindLookRedBag()}animate.init(i.data.amount)}else o.tipDialog(i.data.cause);$("#wrapper").loadding("close")},error:function(){$("#wrapper").loadding("close"),alert("网络不给力，过会儿试试～")}})}})}});new i});