define(["view"],function(i){var a=['<div id="conform-orders-wrapper">','<div class="orders-list-content">','<div class="submit-orders-list">','<div class="orders-title"><%=title%></div>','<div class="orders-detail">','<div class="product-price">','<span class="product-label">单价</span>','<span class="product-price-value fr">¥<%=price%></span>',"</div>",'<div class="line"></div>','<div class="product-num">','<span class="product-label">数量</span>','<span class="product-num-value fr"><%=num%></span>',"</span>","</div>",'<div class="line"></div>','<div class="total-price">','<span class="product-label">总价</span>','<span class="fr total-price-value">¥<%=total_price%></span>',"</div>","</div>","</div>","</div>",'<div class="pay-type">','<span class="zhi-fu-bao"></span>','<div class="zhi-fu-text"><div>支付宝支付</div><div class="zhi-fu-tuiijan">推荐支付宝用户使用</div></div>',"</div>",'<div class="bottom-fixed"><div class="submit-orders-btn">确认支付</div></div>',"</div>"].join(""),e=null,t=function(){var i=$.os.iphone;i=$.os.iphone?"iphone":$.os.android?"android":"other";var a={phone:e.param.phone,city:window.citysEn[e.controller.getStoryItem("liren_city")],deal_id:e.param.deal_id,quantity:e.param.num,total_amount:e.param.total_price,platform:i,title:e.param.title,image_url:e.param.image_url,deal_group_id:e.param.dealgroupid,categories:e.param.categories};$.ajax({type:"get",dataType:"json",data:a,url:"/dp/pay",success:function(i){i.resultCode&&i.resultCode>1?e.href(i.redirectURL):s(1==i.resultCode?'<div class="dialog-alert">提交成功！</div>':'<div class="dialog-alert">'+i.resultMsg+"</div>")},error:function(){}})},r=function(i){if(window.citysEn)i&&i.call(e);else{var a=!0,t=function(i){window.citys={},window.citysEn={};for(var a in i)if(i.hasOwnProperty(a))for(var e=0;e<i[a].length;e++)window.citys[i[a][e].city_name]=i[a][e].districts,window.citysEn[i[a][e].city_name]=i[a][e].enname},r=function(i){a&&(a=!1,$("#wrapper").loadding(),$.ajax({type:"get",dataType:"json",url:"/dp/getCities",success:function(r){a=!0,$("#wrapper").loadding("close"),r&&(t(r),i&&i.call(e))},error:function(){a=!0}}))};r(i)}},s=function(i){e.hasCurrentView()&&$("#wrapper").dialog({width:260,height:200,content:i,title:"",type:1,init:function(){},ok:"确定",cancel:"取消",successCallback:function(){}})};return Jumei.create(i,{onCreate:function(){var i=this,t={price:i.param.price,num:i.param.num,total_price:i.param.total_price,phone:i.param.phone,image_url:i.param.image_url,dealgroupid:i.param.dealgroupid,title:i.param.title},s=Jumei.parseTpl(a,t);e=this,r(function(){i.elem.html(s),$("#beauty_conform_orders .orders-title").subStr(35)})},setTitle:function(){this.title("确认订单")},onRefresh:function(){this.setTitle()},onEvent:function(){this.events={"click .submit-orders-btn":function(){Jumei.ja("dpevent","confirmorder"),t()}}},onClose:function(){}})});