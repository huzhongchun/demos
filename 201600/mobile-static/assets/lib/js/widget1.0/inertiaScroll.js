Jumei.widget("ui.inertiaScroll",{init:function(t){var e=function(){};this.options={id:"content",pullDownCallback:e,pullUpCallback:e,startPullDownCallback:e,startPullDownMaxLength:40},this._super.call(this,t)},_create:function(){var t=this,e=this.options;if(t.time={},t.pageXY={},t.speed=0,t.direction=null,t.parentHeight=0,!e.id||!document.getElementById(e.id.replace(/^#/,"")))return console.log("id或dom为null!"),!1;t.dom=document.getElementById(e.id.replace(/^#/,""));var n=$(this.dom).parent();n.css("overflow","hidden"),t.addListener()},addListener:function(){var t=this,e=this.options,n=t.pageXY;t.touchendFlag=!0;var a=$(t.dom);a.on("touchstart",function(e){e.preventDefault(),t.time.startT=(new Date).getTime(),n.startX=e.touches[0].pageX,n.startY=e.touches[0].pageY;var a=t.getTranslateArray();n.currentX=parseInt(a[0]),n.currentY=parseInt(a[1]),t.stopMoveByCss(n.currentY)}),a.on("touchmove",function(r){if(r.preventDefault(),n.endX=r.touches[0].pageX,n.endY=r.touches[0].pageY,n.moveX=n.endX-n.startX,n.movedY=n.endY-n.startY,t.direction=n.movedY>0?"up":"down",n.targetX=n.currentX+n.movedX,n.targetY=n.currentY+n.movedY,n.currentY<="0"&&n.targetY>0&&t.touchendFlag&&(e.startPullDownCallback(),t.touchendFlag=!1),n.currentY<="0"&&n.targetY>e.startPullDownMaxLength)a.css("-webkit-transform","translate3d(0px, 40px, 0px)");else{var o=t.getMaxMove();n.targetY<-(o+e.startPullDownMaxLength)?a.css("-webkit-transform","translate3d(0px, "+-(e.startPullDownMaxLength+o)+"px, 0px)"):a.css("-webkit-transform","translate3d(0px, "+n.targetY+"px, 0px)")}}),a.on("touchend",function(){var a;t.touchendFlag=!0;var r=t.getTranslateArray();if(n.touchEndX=parseInt(r[0]),n.touchEndY=parseInt(r[1]),t.time.endT=(new Date).getTime(),t.time.moveingT=t.time.endT-t.time.startT,n.moveLen=n.touchEndY-n.currentY,t.speed=Math.abs(n.moveLen/t.time.moveingT),a=t.time.moveingT/200,inertiaMoveY=500*t.speed,"down"==t.direction)var o=n.touchEndY-inertiaMoveY;else var o=n.touchEndY+inertiaMoveY;var s=t.getMaxMove();o>=e.startPullDownMaxLength&&(o=e.startPullDownMaxLength),o<-(s+e.startPullDownMaxLength)&&(o=-(s+e.startPullDownMaxLength)),t.moveByCss(a,o),t.monitor()})},getTranslateArray:function(){var t,e=$(this.dom),n=e.css("-webkit-transform");return t=n.indexOf("matrix")>-1||"none"==n?["0","0","0"]:$.trim(n).match(/-?\d*?.?\d*px/g)},stopMoveByCss:function(t){var e=$(this.dom);e.css({"-webkit-transition":"-webkit-transform 0s ease-out 0s",transition:"-webkit-transform 0s ease-out 0s"}),e.css("-webkit-transform","translate3d(0px, "+t+"px, 0px)")},moveByCss:function(t,e){var n=(this.options,$(this.dom));n.css({"-webkit-transition":"-webkit-transform "+t+"s cubic-bezier(0.333333,0.666667,0.66667,1) 0s",transition:"-webkit-transform "+t+"s cubic-bezier(0.333333,0.666667,0.66667,1) 0s"}),n.css("-webkit-transform","translate3d(0px, "+e+"px, 0px)")},offset:function(t){for(var e=0,n=0,a=t;a.offsetParent;)e+=a.offsetLeft,n+=a.offsetTop,a=a.offsetParent;return{left:e,top:n}},getMaxMove:function(){var t=this.options,e=$("#"+t.id).height(),n=e-$(this.dom).parent().height();return 0>n&&(n=0),n},monitor:function(){var t=this,e=this.options,n=$(this.dom),a=t.getMaxMove(),r=setInterval(function(){var o=t.getTranslateArray(),s=parseInt(o[1]);if(s>0){t.stopMoveByCss(s),t.moveByCss("0.5",0);var i=function(){e.pullDownCallback(),n.off("webkitTransitionEnd")};n.on("webkitTransitionEnd",i),clearInterval(r)}if(-a>s){t.stopMoveByCss(s),t.moveByCss("0.5",-a);var i=function(){e.pullUpCallback(),n.off("webkitTransitionEnd")};n.on("webkitTransitionEnd",i),clearInterval(r)}},100)}});