Jumei.widget("ui.slider",{init:function(e){this.options={id:"slider-boxs",index:0,imgInit:2,autoPlay:!1,switchTime:3e3,animateTime:400,dotsClass:"slider-dots",dotsSelectedClass:"slider-dot-select",showDot:!0,slideEnd:null,slideStart:null,direction:"right"},this._super.call(this,e)},_create:function(){var e=this,t=this.options;if(!t.id||!document.getElementById(t.id.replace(/^#/,"")))return console.log("id或dom为null!"),!1;t.dom=document.getElementById(t.id.replace(/^#/,"")),e.constructor="slider",e.moveFlag=!1,t.dom.className+=" slider";var i,s,n=t.dom.offsetWidth,l=t.dom.children,o=document.createElement("div"),d=o.cloneNode(),a=document.createElement("b"),r=[],h=0,c=l.length;if(0==l.length)return console.log("该选择器下的子元素为空！"),!1;for(;i=l[0];h++)i.className+=" slider-item",i.style.cssText+="width:"+n+"px;float:left",o.appendChild(i),o.setAttribute("class","slide-wrapper clearfloat"),d.appendChild(a.cloneNode()),s=i.getElementsByTagName("img")[0],h<t.imgInit?s&&!s.src&&s.getAttribute("lazyload")&&(s.src=s.getAttribute("lazyload")):r.push(s);o.style.width=n*c+"px",o.style.cssText+="position:relative;left:-"+t.index*n+"px;",d.className=t.dotsClass,t.showDot||(d.style.display="none"),t.dom.appendChild(o),t.dom.appendChild(d),t.wheel=o,t.items=o.children,t.length=t.items.length,1==t.length&&(d.style.display="none"),t.dots=d.children,t.dots.length>0&&(t.dots[t.index].className=t.dotsSelectedClass),t.width=n,t.lazyImgs=r,e.initEvent(),e.start()},initEvent:function(){var e=this,t=this.options;wheel=t.wheel,wheel.addEventListener("touchstart",function(e){t.pageX=e.touches[0].pageX,t.pageY=e.touches[0].pageY,t.S=!1,t.T=!1,t.X=0,t.wheel.style.webkitTransitionDuration="0ms"}),wheel.addEventListener("touchmove",function(i){var s=t.X=i.touches[0].pageX-t.pageX;if(!t.T){var n=Math.abs(s)<Math.abs(i.touches[0].pageY-t.pageY);n||clearTimeout(t.play),t.T=!0,t.S=n}t.S||(i.stopPropagation(),i.preventDefault(),e.moveFlag=!0,0==e.options.index||e.options.index==e.options.length-1?Math.abs(s)<100&&(t.wheel.style.left=s-t.index*t.width+"px"):t.wheel.style.left=s-t.index*t.width+"px")});var i=function(){t.S||e._slide(t.index+(t.X<=-20?Math.ceil(-t.X/t.width):t.X>20?-Math.ceil(t.X/t.width):0))};wheel.addEventListener("touchend",i),wheel.addEventListener("touchcancel",i),wheel.addEventListener("webkitTransitionEnd",function(){e.moveFlag=!1,t.showDot&&(t.dom.querySelector("."+t.dotsSelectedClass).setAttribute("class",""),t.dots[t.index].className=t.dotsSelectedClass),e._setTimeout(),e.options.slideEnd&&e.options.slideEnd.apply(e)})},_slide:function(e,t,i){var s=this,n=this.options;return length=n.length,e>-1&&length>e?s._move(e,i):e>=length?(s._move(length-(t?2:1),i),n.direction=-1):(s._move(t?1:0,i),n.direction=1),s.options.slideStart&&s.options.slideStart.apply(s),s},_move:function(e,t){var i=this,s=this.options,n=s.index;if(s.lazyImgs.length){var l=s.items[e].getElementsByTagName("img")[0];l&&!l.src&&(l.src=l.getAttribute("lazyload"))}s.index=e,1==t?(s.wheel.style.removeProperty("-webkit-transition"),s.wheel.style.cssText+="position:relative;left:-"+e*s.width+"px;",document.getElementById(s.dotsSelectedClass).id="",s.dots[2].id=s.dotsSelectedClass):-1==e||e==s.length?s.wheel.style.cssText+="-webkit-transition:"+s.animateTime+"ms;position:relative;left:-"+(e*s.width-100)+"px":(s.wheel.style.cssText+="-webkit-transition:"+s.animateTime+"ms;position:relative;left:-"+e*s.width+"px",3==n&&2==t&&s.slideEnd&&s.slideEnd.apply(i))},_setTimeout:function(){var e=this,t=e.options;return t.autoPlay?(clearTimeout(t.play),t.play=setTimeout(function(){e._slide.call(e,t.index+t.direction,!0)},t.switchTime),e):e},_resize:function(){var e=this,t=this.options,i=t.dom.offsetWidth,s=t.items,n=document.createElement("b");t.length=$("#slider .slider-item").length;var l=t.length;if(!i)return e;t.width=i,clearTimeout(t.play);var o=document.querySelector(".slider-dots");o.innerHTML="";for(var d=0;l>d;d++)s[d].style.cssText+="width:"+i+"px;",o.appendChild(n.cloneNode());return t.dots=o.children,t.dots[t.index].id=t.dotsSelectedClass,t.wheel.style.removeProperty("-webkit-transition"),t.wheel.style.cssText+="width:"+i*l+"px;position:relative;left:-"+t.index*i+"px;",t.direction=1,$(".slider-dots").html(),e._setTimeout(),e},start:function(){var e=this;return e.options.direction="left"==e.options.direction?-1:1,e._setTimeout(),e},stop:function(){var e=this;return clearTimeout(e.options.play),e},prev:function(){return this._slide(this.options.index-1,!1)},next:function(){return this._slide(this.options.index+1,!1)},moveTo:function(e){return this._slide(e,!1)}});