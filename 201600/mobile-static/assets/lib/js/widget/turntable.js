Jumei.widget("ui.turntable",{init:function(){this.options={url:"",img:"",arrowImg:"",arrowWidth:0,arrowHeight:0,width:320,len:8,random:!1,randomChance:{1:100},prizeArea:{1:{area:[1],message:"满500减50现金券"},2:{area:[2],message:"化妆品小样"},3:{area:[3,6],message:"闪购入场券"},4:{area:[4],message:"价值100元化妆品"},5:{area:[5,7],message:"满200减20现金券"},6:{area:[8],message:"iphone6手机"}},success:function(){alert("已完成")}},this.template='<div class="turntable-area" style="position:relative;"><img class="turntable-arrow turntable-btn" style="position: absolute;z-index: 2;" src="<%=arrowImg%>"><img class="turntable-img" src="<%=img%>"/></div>'},_init:function(){var t=this.options,e=Jumei.parseTpl(this.template,this.options);$(this.element).append(e),$(".turntable-arrow").css({width:t.arrowWidth/2,top:(t.width-t.arrowHeight)/2,left:(t.width-t.arrowWidth/2)/2}),$(".turntable-img").css("width",280),$(".turntable-img-2").css("width",280),$(".turntable-img-3").css("width",280),this.initEvent()},getRand:function(t){var e="",a=0;for(var n in t)a+=t[n];for(var r in t){var i=Math.random()*a;if(i<=t[r]){e=r;break}a-=t[r]}return e},initEvent:function(){var t=this,e=t.options;e.random&&$(".turntable-btn").on("tap",function(){var a=t.getRand(e.randomChance);t.startRotate(a)}),$(".turntable-img").off("webkitTransitionEnd"),$(".turntable-img").on("webkitTransitionEnd",function(){$(".turntable-btn").css("pointer-events","all"),this.style.webkitTransition="-webkit-transform 0ms ease-in-out",this.style.webkitTransform="rotateZ("+t.rotate+"deg)";try{t.args.push(e.prizeArea[t.sign].message),e.success.apply(t,t.args)}catch(a){Jumei.log("没有中奖信息"),e.success.apply(t,[t.sign,"没有中奖信息"])}})},rotate:0,sign:0,prizeMessage:"",startRotate:function(t){var e=this.options,a=this;a.sign=t,a.args=[].slice.call(arguments);var n,r=e.prizeArea[t].area;n=r.length>1?r[Math.floor(Math.random()*r.length)]:r[0];var i=360/e.len,s=i*Math.random();10>=s?s+=10:10>=i-s&&(s-=10);var o=a.rotate=Math.floor((n-1)*i+s),l=$(".turntable-img"),g=$(".turntable-btn");"none"!=g.css("pointer-events")&&(l.css("pointer-events","none"),g.css("pointer-events","none"),l[0].style.webkitTransition="-webkit-transform 6s ease-in-out",l[0].style.webkitTransform="rotateZ("+(3240+o)+"deg)")}});