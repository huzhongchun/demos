Jumei.widget("ui.share",{init:function(){this.options={pic:"",title:"聚美",link_url:"http://d.jumei.com"},this.tpl='<div id="share-module-bg"></div><div id="share-module"><div id="share-module-wrapper"><a id="sina" class="sina" type="sina"><img src="'+Jumei.static+'/image/widget/share/weibo-btn.png"/></a><a id="wechat" class="wechat" type="wechat"><img src="'+Jumei.static+'/image/widget/share/wechat-btn.png"/></a><a id="weixin-friend"  class="weixin-friend" type="weixin-friend"><img src="'+Jumei.static+'/image/widget/share/weixin_friend.png?33"/></a><div style="clear:both;"></div></div><div class="close-share">取   消</div></div>'},_create:function(){var e=this;$("#share-module").length<=0&&$("#wrapper").append(e.tpl),this.showTpl()},showTpl:function(){this.bind(),this.show()},bind:function(){var e=this,i=$("#share-module-wrapper a");i.off("click"),i.on("click",function(){_gaq||_gaq.push(["_trackEvent","share","shareclick"]),_hmt||_hmt.push(["_trackEvent","share","shareclick"]);var i,n=$(this).attr("type"),o="http://service.weibo.com/share/share.php?",t=e.options.link_url,a=e.options.sina_title,s=e.options.sina_pic,c=e.options.weixin_link_url,r=e.options.wechat_title,l=e.options.wechat_pic,h=e.options.wechat_content,d=e.options.weixin_friend_link_url,p=e.options.weixin_friend_pic,m=e.options.weixin_friend_title,u=e.options.weixin_friend_content,w=function(){switch(n){default:case"sina":i=o+"title="+encodeURIComponent(a)+"&pic="+encodeURIComponent(s)+"&url="+encodeURIComponent(t);break;case"wechat":i="jumeimall://action/share/weixin?&link="+encodeURIComponent(c)+"&img="+encodeURIComponent(l)+"&title="+encodeURIComponent(r)+"&des="+encodeURIComponent(h);break;case"weixin-friend":i="jumeimall://action/share/weixin/pengyouquan?&link="+encodeURIComponent(d)+"&img="+encodeURIComponent(p)+"&title="+encodeURIComponent(m)+"&des="+encodeURIComponent(u)}return i};e.options.callback?e.options.callback(function(e){""==e?alert("亲，您已经分享过了"):(t="http://f.m.jumei.com/2048/award/"+e,i=w(),location.href=i)}):(i=w(),location.href=i)});var n=$("#share-module .close-share");n.off("click"),n.on("click",function(){e.close()}),$("#share-module-bg").on("click",function(){e.close()}),$("#share-module-bg").on("tap",function(){e.close()})},close:function(){$("#share-module").removeClass("share-show"),$("#share-module").addClass("share-hide"),$("#share-module-bg").hide()},show:function(){$("#share-module").addClass("share-show"),$("#share-module").removeClass("share-hide"),$("#share-module-bg").show()}});