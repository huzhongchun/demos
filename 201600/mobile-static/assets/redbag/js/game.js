function ParticleSystem(){function t(t){for(var o=0;o<s.length;){var n=s[o];n.age+=t,n.age>=n.life?i(o):o++}}function i(t){s.length>1&&(s[t]=s[s.length-1]),s.pop()}function o(){for(var t in s)s[t].acceleration=e.gravity}function n(){for(var t in e.effectors){var i=e.effectors[t].apply;for(var o in s)i(s[o])}}function r(t){for(var i in s){var o=s[i];o.position=o.position.add(o.velocity.multiply(t)),o.velocity=o.velocity.add(o.acceleration.multiply(t))}}var e=this,s=new Array;this.gravity=new Vector2(0,100),this.effectors=new Array,this.emit=function(t){s.push(t)},this.simulate=function(i){t(i),o(),n(),r(i)};for(var h=[],c=1;11>c;c++){var a=new Image;a.src=Jumei.static+"/image/redbag/"+c+".png",h.push(a)}this.render=function(t){for(var i in s){var o=s[i],n=1-o.age/o.life;t.globalAlpha=n.toFixed(2),t.drawImage(h[o.random],o.position.x,o.position.y,2*o.size,2*o.size),t.fill()}}}function ChamberBox(t,i,o,n){this.apply=function(r){(r.position.x-r.size<t||r.position.x+r.size>o)&&(r.velocity.x=-r.velocity.x),(r.position.y-r.size<i||r.position.y+r.size>n)&&(r.velocity.y=-r.velocity.y)}}Vector2=function(t,i){this.x=t,this.y=i},Vector2.prototype={copy:function(){return new Vector2(this.x,this.y)},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},sqrLength:function(){return this.x*this.x+this.y*this.y},normalize:function(){var t=1/this.length();return new Vector2(this.x*t,this.y*t)},negate:function(){return new Vector2(-this.x,-this.y)},add:function(t){return new Vector2(this.x+t.x,this.y+t.y)},subtract:function(t){return new Vector2(this.x-t.x,this.y-t.y)},multiply:function(t){return new Vector2(this.x*t,this.y*t)},divide:function(t){var i=1/t;return new Vector2(this.x*i,this.y*i)},dot:function(t){return this.x*t.x+this.y*t.y}},Vector2.zero=new Vector2(0,0),Color=function(t,i,o){this.r=t,this.g=i,this.b=o},Color.prototype={copy:function(){return new Color(this.r,this.g,this.b)},add:function(t){return new Color(this.r+t.r,this.g+t.g,this.b+t.b)},multiply:function(t){return new Color(this.r*t,this.g*t,this.b*t)},modulate:function(t){return new Color(this.r*t.r,this.g*t.g,this.b*t.b)},saturate:function(){this.r=Math.min(this.r,1),this.g=Math.min(this.g,1),this.b=Math.min(this.b,1)}},Color.black=new Color(0,0,0),Color.white=new Color(1,1,1),Color.red=new Color(1,0,0),Color.green=new Color(0,1,0),Color.blue=new Color(0,0,1),Color.yellow=new Color(1,1,0),Color.cyan=new Color(0,1,1),Color.purple=new Color(1,0,1),Color.moutchColor=new Color(236/255,44/255,103/255),Particle=function(t,i,o,n,r,e){this.position=t,this.velocity=i,this.acceleration=Vector2.zero,this.age=0,this.life=o,this.color=n,this.size=r,this.random=e};var Game={init:function(){function t(){clearTimeout(s),e=!1}function i(){null!=r&&r.clearRect(0,0,n.width,n.height)}function o(){var t=10*Math.random()*Math.PI;return new Vector2(Math.cos(t),Math.sin(t))}var n,r,e,s,h,c;this.setClient=function(t,i){h=t,c=i},this.start=function(i,o){s&&t(),n=document.getElementById(i),r=n.getContext("2d"),e=!0;var a=function(){o(h,c),e&&(s=setTimeout(a,10))};a()},this.stop=t,this.clearCanvas=i;var a=new ParticleSystem,l=.01;this.step=function(t,n){var e=Math.floor(5*Math.random()),s=Math.floor(10*Math.random());a.emit(new Particle(new Vector2(t,n),o().multiply(500),.4,Color.moutchColor,10+e,s)),a.simulate(l),i(),a.render(r)}}};