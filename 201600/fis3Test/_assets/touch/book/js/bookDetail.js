require(["book/js/public","widget/refreshLoad"],function(t,a){function e(){s.initCommentStars(),$(".desc-text.original").each(function(){var t=this,a=$(this).html().replace(/[\n]/g,"<br>");$(this).data("content_original",a),$(".hidden-box .desc-text-2").html($(this).html()),$(".hidden-box").height()>132?($(this).subStr(165),setTimeout(function(){$(t).data("content_short",$(t).html())},30),$(this).parent().find(".check-more").css("visibility","visible")):$(this).parent().find(".check-more").hide(),$(this).removeClass("original")})}function i(){$.ajax({url:"/book/comment/get_book_comments",type:"get",data:{page:c,book_code:r},success:function(t){if(0==t.code&&t.result.data.item_list.length>0){for(var a=t.result.data.item_list,i=0;i<a.length;i++){var s='<div class="comment-item"><div class="user-info"><span class="user-head" style="background-image: url(http://static.bj.taooo.cc/public/user/avatar/default_avatar_v1.png)"></span><div class="user-text-box"><span class="user-nick">'+a[i].nick+'</span><span class="star-list" data-stars="'+a[i].grade+'"><i class="star-icon"></i><i class="star-icon"></i><i class="star-icon"></i><i class="star-icon"></i><i class="star-icon"></i></span><span class="user-wechat">微信号: '+(a[i].wechat?a[i].wechat:"未公开")+'</span></div></div><div class="user-comment"><span class="desc-text original">'+a[i].content.replace(/[\n]/g,"<br>")+'</span><span class="check-more">更多</span></div></div>';$(".comment-list-area").append(s)}e()}l.changeFlag()},error:function(){l.changeFlag()}})}var s=t,n=a,c=parseInt($(".hidden-page-value").val()),o=parseInt($(".hidden-totalpage-value").val()),r=$(".hidden-bookcode-value").val();s.setWxShareContent(),$(".recommend-desc .desc-text").each(function(){var t=this,a=$(this).html().replace(/[\n]/g,"<br>");$(this).data("content_original",a),$(".hidden-box .desc-text-2").html($(this).html()),$(".hidden-box").height()>132&&($(this).subStr(165),setTimeout(function(){$(t).data("content_short",$(t).html())},30),$(this).parent().find(".check-more").css("visibility","visible")),$(this).removeClass("original")}),e(),$(".content-container").on("click",".check-more",function(){var t=$(this).parent().find(".desc-text");t.data().original?(t.data("original",!1),t.html(t.data().content_short),$(this).text("更多")):(t.data("original",!0),t.html(t.data().content_original),$(this).text("收起"))});var l=new n({triggerLen:400,callback:function(){o>c?(c++,i()):l.changeFlag()}})});