require(["book/js/public","book/js/citys","widget/dialog"],function(e,s,t){function a(){var e=$(".address").data().receiver_state,s=$(".address").data().receiver_city,t=$(".address").data().receiver_district,a=$(".address").data().detail_address;a&&$('input[name="detail_address"]').val(a);for(var n=0;n<d.length;n++){var i=d[n],c="";e&&e==i.name&&(c="selected");var o='<option value="'+i.name+'" '+c+">"+i.name+"</option>",r=$(o).data("city",i.city);$('select[name="receiver_state"]').append(r)}$('select[name="receiver_state"]').on("change",function(){var e=$(this).val(),t=$(this).find('option[value="'+e+'"]').data("city");if($('select[name="receiver_city"]').html(""),t&&t.length>0)for(var a=0;a<t.length;a++){var n=t[a],i="";s&&s==n.name&&(i="selected");var c='<option value="'+n.name+'" '+i+">"+n.name+"</option>",d=$(c).data("area",n.area);$('select[name="receiver_city"]').append(d)}else $('select[name="receiver_city"]').html('<option value="0">选择地址</option>');$('select[name="receiver_city"]').trigger("change")}),$('select[name="receiver_city"]').on("change",function(){var e=$(this).val(),s=$(this).find('option[value="'+e+'"]').data("area");if($('select[name="receiver_district"]').html(""),s&&s.length>0)for(var a=0;a<s.length;a++){var n=s[a],i="";t&&t==n&&(i="selected");var c='<option value="'+n+'" '+i+">"+n+"</option>";$('select[name="receiver_district"]').append(c)}else $('select[name="receiver_district"]').html('<option value="0">选择地址</option>')}),$('select[name="receiver_state"]').trigger("change")}function n(){$(".search-box").show(),$(".search-address-bg").show()}function i(){$(".search-box").hide(),$(".search-address-bg").hide()}var c=e,d=s,o=t;c.setWxShareContent();var r=$(".book-list-area .book-item"),l=r.length;l%2==0?($(r[l-1]).addClass("last-item"),$(r[l-2]).addClass("last-item")):$(r[l-1]).addClass("last-item"),$("body").append('<div class="search-address-bg"></div>'),a(),$(".search-address-box").on("click",function(){n()}),$(".search-address-bg").on("click",function(){i()}),$(".search-btn").on("click",function(){var e=$('select[name="receiver_state"]').val(),s=$('select[name="receiver_city"]').val(),t=$('select[name="receiver_district"]').val(),a=$('input[name="detail_address"]').val();return 0==e||0==t||0==t?(alert("请选择完整的地址信息"),!1):($('input[name="address"]').val(e+s+t+a),void $(".search-box").submit())});var v=$(".self-wechat").val().trim(),m="",b='<div class="send-sms-box sms-box-1"><div class="send-sms-box-title">你的微信将通过短信发送给对方</div><div class="send-sms-box-content">微信号: '+v+'</div><div class="send-sms-box-btns"><span class="sms-btn-item send-btn">发送</span><span class="sms-btn-item cancle-btn">取消</span></div></div>',h='<div class="send-sms-box sms-box-2"><div class="send-sms-box-title">你的微信将通过短信发送给对方</div><div class="send-sms-box-content"><span>微信号: </span><input class="input-wechat" type="text"></div><div class="send-sms-box-btns"><span class="sms-btn-item send-btn">发送</span><span class="sms-btn-item cancle-btn">取消</span></div></div>',p='<div class="send-sms-box sms-box-3"><div class="send-sms-box-content">对方设置不接收书友短信</div><div class="send-sms-box-btns"><span class="sms-btn-item close-btn">关闭</span></div></div>',u='<div class="send-sms-box sms-box-4"><div class="send-sms-box-title">长按可复制微信号</div><div class="send-sms-box-content">微信号: '+m+'</div><div class="send-sms-box-btns"><span class="sms-btn-item close-btn">关闭</span></div></div>',x=new o({content:b,type:"slidedown",width:310}),g=new o({content:h,type:"slidedown",width:310}),w=new o({content:p,type:"slidedown",width:310}),f=new o({content:u,type:"slidedown",width:310});$(".cancle-btn").on("click",function(){$(this).parents(".ui-dialog").hide(),$(".ui-bg").hide()}),$(".close-btn").on("click",function(){$(this).parents(".ui-dialog").hide(),$(".ui-bg").hide()});var y="";$(".send-wechat-btn").on("click",function(){var e=$(this).data().status,s=$(this).data().sms_status,t=$(this).data().order_id;m=$(this).data().wechat,y=t,"yes"==e?($(".sms-box-4 .send-sms-box-content").html("微信号: "+m),f.show()):"yes"==s?v?x.show():g.show():w.show()}),$(".sms-box-2 .send-btn").on("click",function(){var e=$(".sms-box-2 .input-wechat").val().trim();return e?void $.ajax({url:"/book/sms/send_wechat",type:"post",data:{wechat:e,order_id:y,type:"nearby"},success:function(e){0==e.code?(alert("发送成功!"),g.hide()):alert(e.message.text)},error:function(e){var s=JSON.parse(e.responseText);alert(s.message.text)}}):(alert("请输入微信号!"),!1)}),$(".sms-box-1 .send-btn").on("click",function(){$.ajax({url:"/book/sms/send_wechat",type:"post",data:{wechat:v,order_id:y,type:"nearby"},success:function(e){0==e.code?(alert("发送成功!"),x.hide()):alert(e.message.text)},error:function(e){var s=JSON.parse(e.responseText);alert(s.message.text)}})});var _=!1;_=$(".set-status").length>0&&"yes"==$(".set-status").val()?!0:!1,c.settingDialog.init({autoShow:_?!1:!0})});