define(function(){$.fn.scrollStopped=function(t){var e=this,o=$(e),n=null;o.scroll(function(){clearTimeout(n);var e=o.scrollTop();n=setTimeout(function(){var n=o.scrollTop();e==n&&t.call(this)},100)})};var t=function(t){this.settings=$.extend({threshold:0,container:window,urlName:"data-url",placeHolder:"",eventName:"scrollStop",innerScroll:!1,isVertical:!0,picSelector:"",contentSelector:"",reloadTipImg:""},t),this.init()};return t.prototype={contructor:t,init:function(){var t=this.settings;this.initEvent(),t.picSelector&&this.lazyLoadPic(),t.contentSelector&&this.lazyLoadContent()},initEvent:function(){var t=this,e=this.settings;$(window).scrollStopped(function(){e.picSelector&&t.lazyLoadPic(),e.contentSelector&&t.lazyLoadContent()})},lazyLoadPic:function(){var t,e=this.settings,o=0,n=0,a=$(window).height(),r=$(window).scrollTop();o=r-(e.threshold?e.threshold/F.scale:0),n=r+a+(e.threshold?e.threshold/F.scale:0);for(var i=$(e.picSelector+"[data-url]"),c=0;c<i.length;c++){var l=$(i[c]),s="none"==l.parent().css("display")||"none"==l.parent().css("visibility");if(_height=l.parent().height(),t=l.offset().top/F.scale,_offsetBottom=t+_height,!s&&n>=t&&t>=o||n>=_offsetBottom&&_offsetBottom>=o){var h=l.attr("data-background");h?l.css("background-image","url("+l.attr("data-url")+")"):l.attr("src",l.attr("data-url")),l.removeAttr("data-url")}}},lazyLoadContent:function(){var t,e=this,o=this.settings,n=0,a=0,r=$(window).height(),i=$(window).scrollTop();n=i-(o.threshold?o.threshold/F.scale:0),a=i+r+(o.threshold?o.threshold/F.scale:0);for(var c=$(o.contentSelector+"[data-lazy]"),l=0;l<c.length;l++){var s=$(c[l]);if(t=(s.offset().top-r/5)/F.scale,a>=t&&t>=n){var h=$(c[l]).attr("n-id");e.getNoteContentFunc(h,c[l]),s.removeAttr("data-lazy")}}},refresh:function(){this.lazyLoadPic(),this.lazyLoadContent()},getNoteContentFunc:function(t,e){var o="/v1/note/get_content";this.contentAjaxFunc(1,t,o,e)},contentAjaxFunc:function(t,e,o,n){var a=location.origin+"/api?path="+o+'&params={"page":"'+t+'","note_id":"'+e+'"}',r=this;$.ajax({url:a,type:"GET",dataType:"jsonp",success:function(t){0==t.code&&(1!=t.result.page||t.result.content||$(n).find(".colon").hide(),totalContentPages=1==t.result.page_count?0:t.result.page_count,$(n).append(decodeURIComponent(t.result.content.replace(/[\n]/g,"<br>"))),t.result.page<t.result.page_count&&r.getNoteContentFunc())},error:function(){}})}},t});